<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Table</title>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.css"
    />
    <link rel="stylesheet" href="./bootstrap-editable.css" />
    <link rel="stylesheet" href="./table.css" />
  </head>
  <body>
    <div style="padding: 30px"></div>

    <div style="padding: 20px">
      <table
        data-toggle="table"
        id="table"
        data-detail-view="true"
        data-search="true"
        data-show-export="true"
        data-fixed-columns="true"
        data-fixed-number="3"
        data-detail-formatter="detailFormatter"
      >
        <thead>
          <tr>
            <th data-field="id">Id</th>
            <th data-field="name">Name</th>
            <th data-field="city">City</th>
            <th data-field="region">Region</th>
            <th data-field="education">Education</th>
            <th data-field="age">Age</th>
            <th data-field="fake1">Fake1</th>
            <th data-field="fake2">Fake2</th>
            <th data-field="fake3">Fake3</th>
            <th data-field="fake4">Fake4</th>
            <th data-field="fake5">Fake5</th>
            <th data-field="fake1">Fake6</th>
            <th data-field="fake2">Fake7</th>
            <th data-field="fake3">Fake8</th>
            <th data-field="fake4">Fake9</th>
            <th data-field="fake5">Fake10</th>
          </tr>
        </thead>
      </table>
    </div>
    <div
      class="modal fade bd-example-modal-lg"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myLargeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label"
                  >Recipient:</label
                >
                <input type="text" class="form-control" id="recipient-name" />
              </div>
              <div class="form-group">
                <label for="message-text" class="col-form-label"
                  >Message:</label
                >
                <textarea class="form-control" id="message-text"></textarea>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/editable/bootstrap-table-editable.min.js"></script>
    <script src="./bootstrap-editable.js"></script>
    <script src="./bootstrap-editable.min.js"></script>

    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/fixed-columns/bootstrap-table-fixed-columns.js"></script>
    <!-- Export -->
    <script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/tableExport.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF/jspdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.10.21/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/export/bootstrap-table-export.min.js"></script>
    <!-- Export -->

    <script>
      var data = [
        {
          id: "adasd",
          name: "Jen",
          city: "Melbourne",
          region: "Turkey",
          education: "Lisans",
          age: "65",
          fake1: "fake",
          fake2: "fake2",
          fake3: "fake3",
          fake4: "fake4",
          fake5: "fake5",
          fake6: "fake6",
          fake7: "fake7",
          fake8: "fake8",
          fake9: "fake9",
          fake10: "fake10",
        },
        {
          id: "2",
          name: "Roger",
          city: "Melbourne",
          region: "Turkey",
          education: "Lisans",
          age: "34",
          fake1: "fake",
          fake2: "fake2",
          fake3: "fake3",
          fake4: "fake4",
          fake5: "fake5",
          fake6: "fake6",
          fake7: "fake7",
          fake8: "fake8",
          fake9: "fake9",
          fake10: "fake10",
        },
        {
          id: "3",
          name: "Rob",
          city: "Sydney",
          region: "Turkey",
          education: "Lisans",
          age: "23",
          fake1: "fake5sdflksdlfksldfsdfsdf",
          fake2: "fakfake5sdflksdlfksldfsdfsdfe2",
          fake3: "fakfake5sdflksdlfksldfsdfsdfe3",
          fake4: "fake5sdflksdlfksldfsdfsdf",
          fake5: "fake5sdflksdlfksldfsdfsdf",
          fake6: "fake6",
          fake7: "fake7",
          fake8: "fake8",
          fake9: "fake9",
          fake10: "fake10",
        },
      ];

      var detailTableData = [
        {
          id: "1",
          name: "Jen",
          city: "Melbourne",
          region: "Turkey",
          education: "Lisans",
          age: "5667",
          fake1: "fake",
          fake2: "fake2",
          fake3: "fake3",
          fake4: "fake4",
          fake5: "fake5",
          fake6: "fake6",
          fake7: "fake7",
          fake8: "fake8",
          fake9: "fake9",
          fake10: "fake10",
        },
        {
          id: "2",
          name: "Roger",
          city: "Melbourne",
          region: "Turkey",
          education: "Lisans",
          age: "767",
          fake1: "fake",
          fake2: "fake2",
          fake3: "fake3",
          fake4: "fake4",
          fake5: "fake5",
          fake6: "fake6",
          fake7: "fake7",
          fake8: "fake8",
          fake9: "fake9",
          fake10: "fake10",
        },
      ];

      $(function () {
        $("#table")
          .bootstrapTable("destroy")
          .bootstrapTable({
            data: data,
            showColumns: true,
            exportDataType: $(this).val(),
            exportTypes: ["excel", "pdf"],
            columns: [
              {
                field: "state",
                visible: true,
              },
            ],
          });

        $("#exampleModalCenter").on("shown.bs.modal", function () {
          $("#exampleModalCenter").trigger("focus");
        });

        const tbody = document.querySelector("tbody");

        if (tbody) {
          tbody.addEventListener("click", function (e) {
            const cell = e.target.closest("td");
            if (!cell) {
              return;
            }
            const row = cell.parentElement;
            if (cell.cellIndex === 6) {
              $("#recipient-name").val(cell.innerHTML);
            }
            if (cell.cellIndex === 8) {
              $("#recipient-name").val(cell.innerHTML);
            }
            if (
              row.className !== "detail-tr" &&
              (cell.cellIndex === 3 || cell.cellIndex === 4)
            ) {
              cell.setAttribute("id", row.rowIndex + "-" + cell.cellIndex);
            }

            if (row.className !== "detail-tr") {
              editTable(e.target.id, row.rowIndex, cell.cellIndex);
            } else {
              editTable(
                e.target.id,
                cell.id.split("-")[0] + "-" + cell.id.split("-")[1],
                cell.id.split("-")[2]
              );
            }
          });
        }

        var table = document.getElementById("table");
        for (let i in table.rows) {
          let row = table.rows[i];
          if (row.rowIndex !== 0) {
            for (let j in row.cells) {
              let col = row.cells[j];
              if (col.cellIndex === 6) {
                col.setAttribute("data-toggle", "modal");
                col.setAttribute("data-target", ".bd-example-modal-lg");
              }
              if (col.cellIndex === 8) {
                col.setAttribute("data-toggle", "tooltip");
                col.setAttribute("data-html", "true");
                col.setAttribute(
                  "title",
                  "<div>" + col.innerHTML + " + ----<br/>sdfsdf </div>"
                );
              }
            }
          }
        }

        var table = document.getElementById("table-detail");
        for (let i in table.rows) {
          let row = table.rows[i];
          for (let j in row.cells) {
            let col = row.cells[j];
            if (col.cellIndex === 6) {
              col.setAttribute("data-toggle", "modal");
              col.setAttribute("data-target", ".bd-example-modal-lg");
            }
            if (col.cellIndex === 8) {
              col.setAttribute("data-toggle", "tooltip");
              col.setAttribute("data-html", "true");
              col.setAttribute(
                "title",
                "<div>" + col.innerHTML + " + ----<br/>sdfsdf </div>"
              );
            }
          }
        }
        $('[data-toggle="tooltip"]').tooltip();
      });

      function detailFormatter(index, row) {
        var detailTable = document.createElement("table");
        detailTable.setAttribute("id", "table-detail");
        var detailTableBody = document.createElement("tbody");
        detailTableData.map((item, dTIndex) => {
          let i = 0;
          let firstColumnWidth =
            document.getElementById("table").rows[1].cells[0].offsetWidth;
          var tr = document.createElement("tr");
          tr.setAttribute("class", "detail-tr");
          var firstTd = document.createElement("td");
          firstTd.setAttribute("style", "width:" + firstColumnWidth + "px;");
          tr.appendChild(firstTd);

          for (const [key, value] of Object.entries(item)) {
            let columnWidth =
              document.getElementById("table").rows[1].cells[i + 1].offsetWidth;
            var td = document.createElement("td");
            td.innerHTML = value;
            td.appendChild(document.createTextNode("\u0020"));
            td.setAttribute("style", "width:" + columnWidth + "px;");
            if (key === "city") {
              td.setAttribute("id", "detail-" + index + "-" + dTIndex + i);
            }
            tr.appendChild(td);
            i++;
          }
          detailTableBody.appendChild(tr);
        });
        detailTable.appendChild(detailTableBody);
        return detailTable;
      }

      function editTable(eTargetId, rowIndex, cellIndex) {
        console.log(eTargetId, rowIndex + "-" + cellIndex);
        var clickedTd = document.getElementById(rowIndex + "-" + cellIndex);

        if (eTargetId == rowIndex + "-" + cellIndex) {
          var editableInput = document.createElement("input");
          editableInput.setAttribute("id", "editable-input");
          editableInput.setAttribute("value", clickedTd.innerHTML);
          clickedTd.innerHTML = "";
          clickedTd.appendChild(editableInput);
        } else {
          var editableInput = document.getElementById("editable-input");
          editableInput.addEventListener("keyup", function (event) {
            if (event.keyCode === 13) {
              event.preventDefault();
              clickedTd.innerHTML = editableInput.value;
              editableInput.remove();
            }
          });
          editableInput.addEventListener("mouseout", function (event) {
            clickedTd.innerHTML = editableInput.value;
            editableInput.remove();
          });
        }
      }
    </script>
  </body>
</html>
